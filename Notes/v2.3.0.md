# Release Notes v2.3.0

Data de lan√ßamento: 20/01/2026

## üÜï Novidades

### Tooark.Observability - Novo Pacote

Novo pacote de **observabilidade** para aplica√ß√µes .NET, fornecendo integra√ß√£o simplificada com **OpenTelemetry** para coleta de **traces**, **metrics** e **logs** com configura√ß√£o via `appsettings.json` e defaults sensatos.

#### Classes de Configura√ß√£o (Options)

| Classe                 | Descri√ß√£o                                                    |
| ---------------------- | ------------------------------------------------------------ |
| `ObservabilityOptions` | Configura√ß√µes principais de Observability                    |
| `TracingOptions`       | Configura√ß√µes de rastreamento (tracing)                      |
| `MetricsOptions`       | Configura√ß√µes de m√©tricas                                    |
| `LoggingOptions`       | Configura√ß√µes de logging                                     |
| `OtlpOptions`          | Configura√ß√µes do exportador OTLP                             |
| `OtlpBatchOptions`     | Configura√ß√µes do processador Batch (OTLP)                    |
| `DataSensitiveOptions` | Configura√ß√µes de sanitiza√ß√£o de dados sens√≠veis para Tracing |

#### Enumera√ß√µes

| Enum             | Descri√ß√£o                                         |
| ---------------- | ------------------------------------------------- |
| `EProtocolOtlp`  | Protocolo de comunica√ß√£o OTLP (grpc, http)        |
| `EProcessorType` | Tipo de processador de exporta√ß√£o (batch, simple) |

#### Extens√µes de Inje√ß√£o de Depend√™ncia

| M√©todo                     | Descri√ß√£o                                          |
| -------------------------- | -------------------------------------------------- |
| `AddTooarkOpenTelemetry()` | Configura OpenTelemetry com traces, metrics e logs |
| `AddTooarkObservability()` | Configura Observability + OpenTelemetry            |

#### Depend√™ncias

| Pacote                                         | Descri√ß√£o                               |
| ---------------------------------------------- | --------------------------------------- |
| `Tooark.Exceptions`                            | Exce√ß√µes customizadas                   |
| `OpenTelemetry`                                | SDK base do OpenTelemetry               |
| `OpenTelemetry.Exporter.Console`               | Exporter para console (desenvolvimento) |
| `OpenTelemetry.Exporter.OpenTelemetryProtocol` | Exporter OTLP (gRPC/HTTP)               |
| `OpenTelemetry.Extensions.Hosting`             | Integra√ß√£o com Host do .NET             |
| `OpenTelemetry.Instrumentation.AspNetCore`     | Instrumenta√ß√£o autom√°tica ASP.NET Core  |
| `OpenTelemetry.Instrumentation.Http`           | Instrumenta√ß√£o autom√°tica HttpClient    |
| `OpenTelemetry.Instrumentation.Runtime`        | M√©tricas do runtime .NET                |

---

## Principais Funcionalidades

### Configura√ß√£o via appsettings.json

O pacote permite configura√ß√£o completa via `appsettings.json`:

```json
{
  "Observability": {
    "Enabled": true,
    "ServiceName": "MeuServico",
    "ServiceVersion": "1.0.0",
    "Otlp": {
      "Enabled": true,
      "Endpoint": "http://localhost:4317",
      "Protocol": "grpc"
    }
  }
}
```

### Configura√ß√£o M√≠nima

```json
{
  "Observability": {
    "ServiceName": "MeuServico",
    "Otlp": {
      "Enabled": true,
      "Endpoint": "http://localhost:4317"
    }
  }
}
```

### Configura√ß√£o Serverless

Para ambientes serverless (AWS ECS, GCP Cloud Run, Azure Container Apps):

```json
{
  "Observability": {
    "ServiceName": "MeuServico",
    "Otlp": {
      "Enabled": true,
      "Endpoint": "http://otel-collector:4317",
      "ServerlessOptimized": true
    }
  }
}
```

### Program.cs

```csharp
using Tooark.Observability.Injections;

var builder = WebApplication.CreateBuilder(args);

// Adiciona OpenTelemetry com configura√ß√µes do appsettings.json
builder.Services.AddTooarkOpenTelemetry(builder.Configuration);

var app = builder.Build();
app.Run();
```

### Configura√ß√£o Program√°tica

```csharp
builder.Services.AddTooarkOpenTelemetry(builder.Configuration, options =>
{
    options.ServiceName = "MeuServicoCustomizado";
    options.Tracing.SamplingRatio = 0.5;

    options.ConfigureTracing = builder =>
    {
        // Configura√ß√£o adicional de tracing
    };

    options.ConfigureMetrics = builder =>
    {
        // Configura√ß√£o adicional de m√©tricas
    };

    options.ConfigureLogging = loggerOptions =>
    {
        // Configura√ß√£o adicional de logging
    };
});
```

---

## Caracter√≠sticas do Pacote

### Tracing

- **ASP.NET Core Instrumentation**: captura automaticamente traces de requisi√ß√µes HTTP de entrada
- **HTTP Client Instrumentation**: captura traces de requisi√ß√µes HTTP de sa√≠da (HttpClient)
- **Filter Paths**: por padr√£o ignora: `/health`, `/healthz`, `/ready`, `/traces`, `/metrics`, `/logs`, `/favicon.ico`
- **RecordException**: exce√ß√µes s√£o registradas automaticamente nos spans
- **Sampling**: configur√°vel via `SamplingRatio` (0.0 = 0%, 1.0 = 100%)

### Sanitiza√ß√£o de Dados Sens√≠veis

Quando `DataSensitive = false` (padr√£o):

- **Query Parameters**: removidos do atributo `http.target`
- **Headers Sens√≠veis**: mascarados nos spans (Authorization, Cookie, API keys, etc.)

### Metrics

- **ASP.NET Core Instrumentation**: m√©tricas de requisi√ß√µes HTTP de entrada
- **HTTP Client Instrumentation**: m√©tricas de chamadas HTTP de sa√≠da
- **Runtime Instrumentation**: m√©tricas do runtime .NET (GC, threads, etc.)

### Logging

- Integra com `Microsoft.Extensions.Logging`
- Exporta logs via OTLP junto com traces e metrics
- Correlaciona automaticamente logs com traces (TraceId/SpanId)

### Exportadores

| Exportador  | Ativa√ß√£o                                                                       | Tipo |
| ----------- | ------------------------------------------------------------------------------ | ---- |
| **OTLP**    | `Otlp.Enabled = true` + `Otlp.Endpoint` configurado                            | Push |
| **Console** | Ambiente `Development` + `UseConsoleExporterInDevelopment` + OTLP desabilitado | Push |

> **Nota**: Este pacote **n√£o exp√µe endpoints HTTP** para coleta de m√©tricas (como `/metrics` do Prometheus). Usa apenas o modelo **push** via OTLP.

---

## Testes Adicionados

### Tooark.Tests/Observability

Novos testes unit√°rios para o pacote `Tooark.Observability`:

| Arquivo                                                     | Descri√ß√£o                            |
| ----------------------------------------------------------- | ------------------------------------ |
| `Enums/EProcessorTypeTests.cs`                              | Testes para enum `EProcessorType`    |
| `Enums/EProtocolOtlpTests.cs`                               | Testes para enum `EProtocolOtlp`     |
| `Injections/TooarkDependencyInjectionTests.cs`              | Testes para `AddTooarkObservability` |
| `Injections/TooarkDependencyInjectionOpenTelemetryTests.cs` | Testes para `AddTooarkOpenTelemetry` |
| `Injections/TooarkDependencyInjectionTracingTests.cs`       | Testes para configura√ß√£o de Tracing  |
| `Injections/TooarkDependencyInjectionMetricsTests.cs`       | Testes para configura√ß√£o de Metrics  |
| `Injections/TooarkDependencyInjectionLoggingTests.cs`       | Testes para configura√ß√£o de Logging  |
| `Options/ObservabilityOptionsTests.cs`                      | Testes para `ObservabilityOptions`   |
| `Options/TracingOptionsTests.cs`                            | Testes para `TracingOptions`         |
| `Options/MetricsOptionsTests.cs`                            | Testes para `MetricsOptions`         |
| `Options/LoggingOptionsTests.cs`                            | Testes para `LoggingOptions`         |
| `Options/OtlpOptionsTests.cs`                               | Testes para `OtlpOptions`            |
| `Options/OtlpBatchOptionsTests.cs`                          | Testes para `OtlpBatchOptions`       |
| `Options/DataSensitiveOptionsTests.cs`                      | Testes para `DataSensitiveOptions`   |

---

## Documenta√ß√£o

### README.md Atualizado

O arquivo `README.md` do pacote `Tooark.Observability` foi criado com documenta√ß√£o completa incluindo:

- Tabela de classes e m√©todos dispon√≠veis
- Exemplos de configura√ß√£o via `appsettings.json` (completa, m√≠nima e serverless)
- Exemplos de uso com `Program.cs`
- Tabelas de todas as op√ß√µes de configura√ß√£o com tipos e valores padr√£o
- Integra√ß√£o com coletores (OpenTelemetry Collector, Jaeger, Grafana Cloud, Azure Monitor)
- Recomenda√ß√µes para ambientes serverless
- Exemplos de traces e m√©tricas customizadas

---

## Uso

### Instala√ß√£o

```bash
dotnet add package Tooark.Observability
```

### Configura√ß√£o B√°sica

1. Adicione a se√ß√£o `Observability` no `appsettings.json`
2. Chame `AddTooarkOpenTelemetry()` ou `AddTooarkObservability()` no `Program.cs`
3. Configure o endpoint OTLP do seu coletor (Jaeger, OTEL Collector, Grafana, etc.)

---

## Impacto

- **Sem breaking changes** - Pacote totalmente novo
- **Compatibilidade** - Compat√≠vel com .NET 8.0+
- **Modelo Push** - N√£o exp√µe endpoints HTTP para scraping (Prometheus-style)

---

## Aten√ß√£o

- Vers√£o `v2.*` ser√° mantida para corre√ß√µes de bugs e melhorias menores.
- Novas funcionalidades e mudan√ßas maiores ser√£o lan√ßadas na s√©rie `v3.*`.

## Informa√ß√µes Adicionais

- Tag relacionado: `v2.3.0`
- Data de lan√ßamento: **2026-01-20**
