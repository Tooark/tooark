# Release Notes v2.2.1

Data de lançamento: 06/01/2026

## Mudanças principais

### Tooark.Securities - Métodos de Injeção de Dependência Separados

Adicionados métodos de extensão individuais para registro de serviços, permitindo maior flexibilidade na configuração.

#### Novos Métodos

| Método                  | Descrição                                 |
| ----------------------- | ----------------------------------------- |
| `AddTooarkJwtToken`     | Registra apenas o serviço de token JWT    |
| `AddTooarkCryptography` | Registra apenas o serviço de criptografia |

#### Arquivos Adicionados

- `TooarkDependencyInjectionJwtToken.cs` - Método de extensão para JWT
- `TooarkDependencyInjectionCryptography.cs` - Método de extensão para Criptografia

### Tooark.Securities - Registro Condicional de Serviços

O método `AddTooarkSecurities` agora verifica se as seções de configuração existem antes de registrar os serviços correspondentes, evitando erros quando apenas uma das configurações é fornecida.

```csharp
// Agora você pode configurar apenas JWT ou apenas Cryptography
public static IServiceCollection AddTooarkSecurities(this IServiceCollection services, IConfiguration configuration)
{
    // Registra JWT apenas se a seção existir
    if (configuration.GetSection(JwtOptions.Section).Exists())
    {
        AddTooarkJwtToken(services, configuration);
    }

    // Registra Cryptography apenas se a seção existir
    if (configuration.GetSection(CryptographyOptions.Section).Exists())
    {
        AddTooarkCryptography(services, configuration);
    }

    return services;
}
```

### Tooark - Registro Condicional de Securities

O método `AddTooarkService` agora aceita `IConfiguration?` como parâmetro opcional e registra os serviços de Securities apenas quando a configuração é fornecida e contém as seções necessárias.

```csharp
// Uso sem Securities (configuration opcional)
services.AddTooarkService();

// Uso com Securities (quando configuração existe)
services.AddTooarkService(configuration);
```

## Testes Adicionados

### Tooark.Tests/Securities/Injections

| Arquivo                                         | Testes                              |
| ----------------------------------------------- | ----------------------------------- |
| `TooarkDependencyInjectionJwtTokenTests.cs`     | Testes para `AddTooarkJwtToken`     |
| `TooarkDependencyInjectionCryptographyTests.cs` | Testes para `AddTooarkCryptography` |
| `TooarkDependencyInjectionSecuritiesTests.cs`   | Testes para `AddTooarkSecurities`   |

### Tooark.Tests/Injections

| Arquivo                             | Testes Adicionados                                          |
| ----------------------------------- | ----------------------------------------------------------- |
| `TooarkDependencyInjectionTests.cs` | Testes para cobertura do registro condicional de Securities |

#### Cenários de Teste Cobertos

- Configuration `null` - nenhum serviço de Securities registrado
- Configuration sem seções JWT/Cryptography - nenhum serviço registrado
- Apenas seção JWT configurada - somente `IJwtTokenService` disponível
- Apenas seção Cryptography configurada - somente `ICryptographyService` disponível
- Ambas seções configuradas - ambos serviços disponíveis

## Impacto

- **Sem breaking changes** - O método `AddTooarkSecurities` continua funcionando como antes
- **Maior flexibilidade** - Agora é possível registrar apenas JWT ou apenas Cryptography
- **Melhor experiência** - Não é mais necessário configurar ambas as seções se você usa apenas uma

## Configuração

### Usando apenas JWT

```json
{
  "Jwt": {
    "Algorithm": "HS256",
    "Secret": "sua-chave-secreta-com-pelo-menos-32-caracteres",
    "Issuer": "sua-aplicacao",
    "Audience": "seus-clientes",
    "ExpirationTime": 60
  }
}
```

```csharp
// Opção 1: Via AddTooarkSecurities (detecta automaticamente)
services.AddTooarkSecurities(configuration);

// Opção 2: Via AddTooarkJwtToken (direto)
services.AddTooarkJwtToken(configuration);
```

### Usando apenas Cryptography

```json
{
  "Cryptography": {
    "Algorithm": "GCM",
    "Secret": "sua-chave-secreta-de-32-caracteres"
  }
}
```

```csharp
// Opção 1: Via AddTooarkSecurities (detecta automaticamente)
services.AddTooarkSecurities(configuration);

// Opção 2: Via AddTooarkCryptography (direto)
services.AddTooarkCryptography(configuration);
```

## Informações Adicionais

- Tag relacionado: `v2.2.1`
- Data de lançamento: **2026-01-06**
